graph TD
    A["Password Hashing"] --> B["Algorithm: bcrypt<br/>Cost: 12<br/>Output: 60-char hash"]
    
    B --> C["Store in Database<br/>users.password_hash"]
    
    D["Password Validation"] --> E["User Login<br/>Input: plain password"]
    
    E --> F["Retrieve user.password_hash<br/>from database"]
    
    F --> G["bcrypt.CompareHash<br/>plain password +<br/>stored hash"]
    
    G --> H{"Hash Matches?"}
    
    H -->|Yes| I["Password Valid<br/>Proceed with login"]
    
    H -->|No| J["Password Invalid<br/>Reject login"]
    
    K["Password Change<br/>User updates password"] --> L["Validate new password<br/>- Min 8 chars<br/>- Max 128 chars<br/>- Requires uppercase<br/>- Requires lowercase<br/>- Requires number<br/>- Requires special char<br/>- Not in common list"]
    
    L --> M{"Password<br/>Valid?"}
    
    M -->|No| N["Return validation error"]
    
    M -->|Yes| O["Generate new bcrypt hash"]
    
    O --> P["Update database<br/>- password_hash<br/>- password_changed_at = NOW"]
    
    P --> Q["Invalidate all tokens<br/>issued before password change<br/>Check: token.issued_at <<br/>user.password_changed_at"]